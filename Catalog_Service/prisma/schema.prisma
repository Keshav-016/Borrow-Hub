// ------------------------------------------------------
// Catalog Service Prisma Schema (ToolLib)
// ------------------------------------------------------

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// ------------------------------------------------------
// ENUMS
// ------------------------------------------------------

enum ItemStatus {
  AVAILABLE
  RENTED
  MAINTENANCE
  DELETED
}

enum ConditionTag {
  EXCELLENT
  GOOD
  FAIR
  POOR
}

// ------------------------------------------------------
// MODELS
// ------------------------------------------------------

model Item {
  id               String          @id @default(uuid())
  ownerUserId      String          // from User Service (UUID reference, not FK)
  title            String
  description      String?
  categoryId       String?         // reference to ItemCategory (optional)
  pricePerHour     Decimal?        @db.Decimal(10, 2)
  pricePerDay      Decimal?        @db.Decimal(10, 2)
  securityDeposit  Decimal?        @db.Decimal(10, 2) @default(0)
  conditionTag     ConditionTag    @default(GOOD)
  status           ItemStatus      @default(AVAILABLE)

  // Geo-location for proximity search
  latitude         Float?
  longitude        Float?
  address          String?
  city             String?
  state            String?
  pincode          String?

  // Ratings cached from reputation service
  ratingAverage    Float?          @default(0)
  totalRatings     Int?            @default(0)

  // Relations
  images           ItemImage[]
  availability     ItemAvailability[]
  itemTags         ItemTagMap[]
  category         ItemCategory?   @relation(fields: [categoryId], references: [id])

  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt
}

// ------------------------------------------------------
// IMAGES
// ------------------------------------------------------

model ItemImage {
  id          String   @id @default(uuid())
  itemId      String
  imageUrl    String
  uploadedAt  DateTime @default(now())

  item        Item     @relation(fields: [itemId], references: [id], onDelete: Cascade)

  @@index([itemId])
}

// ------------------------------------------------------
// AVAILABILITY SLOTS
// ------------------------------------------------------

model ItemAvailability {
  id          String    @id @default(uuid())
  itemId      String
  startTime   DateTime
  endTime     DateTime
  isBooked    Boolean   @default(false)

  item        Item      @relation(fields: [itemId], references: [id], onDelete: Cascade)

  @@index([itemId])
}

// ------------------------------------------------------
// CATEGORY (Static lookup or admin-managed)
// ------------------------------------------------------

model ItemCategory {
  id          String    @id @default(uuid())
  name        String    @unique
  description String?
  iconUrl     String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  items       Item[]
}

// ------------------------------------------------------
// TAGS (optional extension â€” for search/filter)
// ------------------------------------------------------

model ItemTag {
  id        String    @id @default(uuid())
  name      String    @unique
  createdAt DateTime  @default(now())
  itemTags  ItemTagMap[]
}

// Junction table between Item & Tag
model ItemTagMap {
  id      String   @id @default(uuid())
  itemId  String
  tagId   String

  item    Item     @relation(fields: [itemId], references: [id], onDelete: Cascade)
  tag     ItemTag  @relation(fields: [tagId], references: [id], onDelete: Cascade)
}
